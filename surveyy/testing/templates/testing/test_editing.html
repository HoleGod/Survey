{% extends "base.html" %}

{% block content %}
<div class="border-1 p-4 mb-3">
    <h1>Editing {{ test.title }}:</h1>
</div>

<form action="{% url 'edit' test.id %}" method="post" enctype="multipart/form-data">
    {% csrf_token %}

    {# Test info #}
    <div class="mb-3">
        <label for="test-label" class="form-label">Title:</label>
        <input type="text" class="form-control" name="label" id="test-label" value="{{ test.title }}" required>
    </div>

    <div class="mb-3">
        <label for="test-banner" class="form-label">Banner:</label>
        {% if test.image %}
        <div class="mb-2">
            <img src="{{ test.image.url }}" alt="Current banner" style="max-width:200px;">
        </div>
        {% endif %}
        <input type="file" class="form-control" name="banner" id="test-banner">
    </div>

    {# Questions #}
    <div id="questionsContainer">
        {% for q in test.questions.all %}
        <div class="mb-4 border p-3">
            <input type="hidden" name="q.id" value="{{ q.id }}">
            <input type="text" class="form-control mb-2" value="{{ q.text }}" name="question_{{ q.id }}_text" required>

            <div id="answersContainer_{{ q.id }}">
                {% for a in q.answers.all %}
                <div class="answer-row mb-2 d-flex align-items-center gap-2">
                    <input type="{% if q.question_type == 'single' %}radio{% else %}checkbox{% endif %}"
                        name="question_{{ q.id }}_answer" value="{{ a.id }}" class="form-check-input" {% if a.is_correct %}checked{% endif %}>
                    <input type="text" class="form-control" name="question_{{ q.id }}_answer_{{ a.id }}"
                        value="{{ a.text }}" required>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>

    <button type="submit" class="btn btn-primary">Save changes!</button>
</form>
{% endblock content %}